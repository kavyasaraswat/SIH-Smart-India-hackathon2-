<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Puzzle Quest - Polygon Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #e9d5ff 0%, #a855f7 100%);
            font-family: 'Inter', sans-serif;
        }
        .game-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .puzzle-piece {
            transition: all 0.5s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .puzzle-piece.locked {
            filter: grayscale(100%) brightness(0.3);
        }
        .puzzle-piece.unlocked {
            filter: none;
            animation: reveal 0.8s ease-out;
        }
        .puzzle-piece.current {
            border: 3px solid #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.5);
        }
        @keyframes reveal {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        .option-btn {
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .correct {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        .wrong {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent),
                radial-gradient(1px 1px at 130px 80px, #fff, transparent),
                radial-gradient(2px 2px at 160px 30px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 100px;
            animation: twinkle 3s ease-in-out infinite alternate;
        }
        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        .puzzle-image {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            border-radius: 8px;
        }
        .polygon-svg {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <!-- Stars Background -->
    <div class="stars"></div>
    
    <div class="relative z-10 max-w-6xl mx-auto">
        <!-- Main Menu -->
        <div id="mainMenu" class="game-card rounded-2xl p-8 text-center shadow-2xl">
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-purple-800 mb-2">üßÆ Math Puzzle Quest</h1>
                <p class="text-purple-600 text-lg">Solve Math Questions to Reveal Geometric Shapes!</p>
            </div>
            <div class="mb-8">
                <div class="bg-purple-100 rounded-lg p-4 mb-4">
                    <h3 class="font-semibold text-purple-800 mb-2">How to Play:</h3>
                    <ul class="text-purple-700 text-sm space-y-1">
                        <li>üß© Click on locked puzzle pieces to answer questions</li>
                        <li>‚úÖ Correct answers unlock the piece (+5 points)</li>
                        <li>‚ùå Wrong answers keep the piece locked</li>
                        <li>üéØ Unlock all 9 pieces to complete the geometric shape!</li>
                    </ul>
                </div>
            </div>
            <button onclick="startGame()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-8 rounded-xl text-xl transition-all duration-300 transform hover:scale-105 shadow-lg">
                üöÄ Start Puzzle
            </button>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <!-- Header -->
            <div class="game-card rounded-2xl p-6 mb-6 shadow-2xl">
                <div class="flex justify-between items-center">
                    <div class="bg-purple-100 rounded-lg px-4 py-2">
                        <span class="text-purple-800 font-semibold">Score: </span>
                        <span id="score" class="text-purple-900 font-bold text-xl">0</span>
                    </div>
                    <div class="bg-purple-100 rounded-lg px-4 py-2">
                        <span class="text-purple-800 font-semibold">Unlocked: </span>
                        <span id="unlockedCount" class="text-purple-900 font-bold text-xl">0</span>/9
                    </div>
                    <button onclick="goToMainMenu()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300">
                        üè† Main Menu
                    </button>
                </div>
            </div>

            <!-- Puzzle Grid -->
            <div class="game-card rounded-2xl p-6 mb-6 shadow-2xl">
                <h2 class="text-2xl font-bold text-center text-purple-800 mb-6" id="puzzleTitle">Geometric Shape Puzzle</h2>
                <div class="grid grid-cols-3 gap-4 max-w-2xl mx-auto" id="puzzleGrid">
                    <!-- Puzzle pieces will be generated here -->
                </div>
            </div>

            <!-- Question Panel -->
            <div id="questionPanel" class="game-card rounded-2xl p-6 shadow-2xl hidden">
                <div class="text-center mb-4">
                    <h3 class="text-xl font-semibold text-purple-800">Unlock Puzzle Piece</h3>
                </div>
                <div class="mb-6">
                    <h4 id="question" class="text-lg font-semibold text-gray-800 mb-4 leading-relaxed"></h4>
                    <div id="options" class="space-y-3"></div>
                </div>
                <div class="text-center">
                    <button onclick="closeQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-all duration-300">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Victory Screen -->
        <div id="victoryScreen" class="game-card rounded-2xl p-8 text-center shadow-2xl hidden">
            <div class="mb-6">
                <h2 class="text-4xl font-bold text-green-600 mb-4">üéâ Puzzle Complete!</h2>
                <p class="text-2xl text-purple-800 mb-4">You've revealed the entire geometric shape!</p>
                <div class="bg-purple-100 rounded-lg p-6 mb-6">
                    <p class="text-purple-800 text-lg mb-2">Your Final Score:</p>
                    <p id="finalScore" class="text-4xl font-bold text-purple-900">0</p>
                </div>
            </div>
            <div class="space-y-4">
                <button onclick="startGame()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg w-full">
                    üîÑ New Puzzle
                </button>
                <button onclick="goToMainMenu()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg w-full">
                    üè† Main Menu
                </button>
            </div>
        </div>
    </div>

    <script>
        // Math questions database (60 questions)
        const mathQuestions = [
            // Numbers & Operations (15 questions)
            {
                question: "What is the value of 7 √ó 8?",
                options: ["54", "56", "64", "72"],
                correct: 1,
                topic: "Numbers & Operations"
            },
            {
                question: "Which fraction is equivalent to 0.75?",
                options: ["1/4", "1/2", "3/4", "2/3"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "What is the least common multiple of 6 and 8?",
                options: ["12", "16", "24", "48"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "Which number is prime?",
                options: ["15", "21", "29", "33"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "What is 3/5 + 2/3?",
                options: ["5/8", "6/15", "19/15", "1 4/15"],
                correct: 3,
                topic: "Numbers & Operations"
            },
            {
                question: "What is 25% of 80?",
                options: ["15", "20", "25", "30"],
                correct: 1,
                topic: "Numbers & Operations"
            },
            {
                question: "Which number is a perfect square?",
                options: ["20", "24", "36", "50"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "What is the value of 4¬≥?",
                options: ["12", "16", "64", "256"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "What is the next number in the sequence: 2, 5, 11, 23, ___?",
                options: ["35", "41", "47", "53"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "Which is the smallest number?",
                options: ["-5", "-2", "0.1", "-10"],
                correct: 3,
                topic: "Numbers & Operations"
            },
            {
                question: "What is 7.2 √∑ 0.9?",
                options: ["0.8", "8", "80", "0.08"],
                correct: 1,
                topic: "Numbers & Operations"
            },
            {
                question: "Which number is divisible by 3?",
                options: ["112", "215", "324", "418"],
                correct: 2,
                topic: "Numbers & Operations"
            },
            {
                question: "What is the greatest common factor of 36 and 54?",
                options: ["6", "9", "12", "18"],
                correct: 3,
                topic: "Numbers & Operations"
            },
            {
                question: "What is 2/3 √ó 5/8?",
                options: ["10/24", "5/12", "7/11", "3/5"],
                correct: 1,
                topic: "Numbers & Operations"
            },
            {
                question: "Which number is irrational?",
                options: ["‚àö4", "‚àö9", "‚àö16", "‚àö2"],
                correct: 3,
                topic: "Numbers & Operations"
            },
            
            // Measurement (15 questions)
            {
                question: "How many centimeters are in 2.5 meters?",
                options: ["25 cm", "250 cm", "2500 cm", "0.25 cm"],
                correct: 1,
                topic: "Measurement"
            },
            {
                question: "What is the perimeter of a rectangle with length 8 cm and width 5 cm?",
                options: ["13 cm", "26 cm", "40 cm", "80 cm"],
                correct: 1,
                topic: "Measurement"
            },
            {
                question: "How many milliliters are in 3.5 liters?",
                options: ["35 ml", "350 ml", "3500 ml", "0.35 ml"],
                correct: 2,
                topic: "Measurement"
            },
            {
                question: "What is the area of a triangle with base 10 cm and height 8 cm?",
                options: ["18 cm¬≤", "40 cm¬≤", "80 cm¬≤", "160 cm¬≤"],
                correct: 1,
                topic: "Measurement"
            },
            {
                question: "Which unit would you use to measure the weight of a pencil?",
                options: ["Kilograms", "Grams", "Milligrams", "Tons"],
                correct: 1,
                topic: "Measurement"
            },
            {
                question: "How many minutes are in 2.5 hours?",
                options: ["120 minutes", "150 minutes", "180 minutes", "210 minutes"],
                correct: 1,
                topic: "Measurement"
            },
            {
                question: "What is the volume of a cube with side length 4 cm?",
                options: ["16 cm¬≥", "32 cm¬≥", "64 cm¬≥", "128 cm¬≥"],
                correct: 2,
                topic: "Measurement"
            },
            {
                question: "Which is the longest measurement?",
                options: ["1 meter", "100 centimeters", "1000 millimeters", "0.001 kilometers"],
                correct: 3,
                topic: "Measurement"
            },
            {
                question: "What is the circumference of a circle with radius 7 cm? (Use œÄ = 22/7)",
                options: ["22 cm", "44 cm", "88 cm", "154 cm"],
                correct: 1,
                topic: "Measurement"
            },
            {
                question: "How many grams are in 3.5 kilograms?",
                options: ["35 g", "350 g", "3500 g", "0.35 g"],
                correct: 2,
                topic: "Measurement"
            },
            {
                question: "What is the area of a circle with radius 5 cm? (Use œÄ = 3.14)",
                options: ["15.7 cm¬≤", "31.4 cm¬≤", "78.5 cm¬≤", "157 cm¬≤"],
                correct: 2,
                topic: "Measurement"
            },
            {
                question: "Which unit would you use to measure the capacity of a swimming pool?",
                options: ["Milliliters", "Liters", "Kiloliters", "Grams"],
                correct: 2,
                topic: "Measurement"
            },
            {
                question: "What is the perimeter of a square with area 36 cm¬≤?",
                options: ["6 cm", "12 cm", "24 cm", "36 cm"],
                correct: 2,
                topic: "Measurement"
            },
            {
                question: "How many seconds are in 2 hours and 30 minutes?",
                options: ["9000 seconds", "7500 seconds", "6000 seconds", "4500 seconds"],
                correct: 0,
                topic: "Measurement"
            },
            {
                question: "What is the surface area of a cube with side length 3 cm?",
                options: ["9 cm¬≤", "18 cm¬≤", "27 cm¬≤", "54 cm¬≤"],
                correct: 3,
                topic: "Measurement"
            },
            
            // Geometry (15 questions)
            {
                question: "How many sides does a hexagon have?",
                options: ["5", "6", "7", "8"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "What is the sum of interior angles in a triangle?",
                options: ["90¬∞", "180¬∞", "270¬∞", "360¬∞"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "Which polygon has all sides equal and all angles equal?",
                options: ["Regular polygon", "Irregular polygon", "Concave polygon", "Complex polygon"],
                correct: 0,
                topic: "Geometry"
            },
            {
                question: "What is the name of a 3D shape with 6 square faces?",
                options: ["Cube", "Cuboid", "Pyramid", "Prism"],
                correct: 0,
                topic: "Geometry"
            },
            {
                question: "How many vertices does a rectangular prism have?",
                options: ["6", "8", "10", "12"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "What is the name of an angle that measures exactly 90¬∞?",
                options: ["Acute angle", "Obtuse angle", "Right angle", "Straight angle"],
                correct: 2,
                topic: "Geometry"
            },
            {
                question: "Which triangle has all sides of different lengths?",
                options: ["Equilateral", "Isosceles", "Scalene", "Right"],
                correct: 2,
                topic: "Geometry"
            },
            {
                question: "What is the name of a line that divides a circle into two equal halves?",
                options: ["Radius", "Diameter", "Chord", "Tangent"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "How many faces does a triangular prism have?",
                options: ["4", "5", "6", "7"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "What is the name of a quadrilateral with exactly one pair of parallel sides?",
                options: ["Square", "Rectangle", "Trapezoid", "Rhombus"],
                correct: 2,
                topic: "Geometry"
            },
            {
                question: "Which shape has rotational symmetry of order 4?",
                options: ["Equilateral triangle", "Square", "Regular pentagon", "Circle"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "What is the name of a 3D shape with a circular base and a vertex?",
                options: ["Cone", "Cylinder", "Sphere", "Pyramid"],
                correct: 0,
                topic: "Geometry"
            },
            {
                question: "How many lines of symmetry does a rectangle have?",
                options: ["1", "2", "4", "None"],
                correct: 1,
                topic: "Geometry"
            },
            {
                question: "What is the name of an angle that measures more than 90¬∞ but less than 180¬∞?",
                options: ["Acute angle", "Right angle", "Obtuse angle", "Reflex angle"],
                correct: 2,
                topic: "Geometry"
            },
            {
                question: "Which solid has no edges or vertices?",
                options: ["Cube", "Cylinder", "Sphere", "Cone"],
                correct: 2,
                topic: "Geometry"
            },
            
            // Algebra (15 questions)
            {
                question: "If x + 5 = 12, what is the value of x?",
                options: ["5", "6", "7", "8"],
                correct: 2,
                topic: "Algebra"
            },
            {
                question: "What is the simplified form of 3a + 2b - a + 4b?",
                options: ["2a + 6b", "4a + 6b", "2a + 2b", "4a + 2b"],
                correct: 0,
                topic: "Algebra"
            },
            {
                question: "If y = 3x + 2 and x = 4, what is the value of y?",
                options: ["10", "12", "14", "16"],
                correct: 2,
                topic: "Algebra"
            },
            {
                question: "What is the solution to the equation 2x - 7 = 11?",
                options: ["x = 2", "x = 7", "x = 9", "x = 18"],
                correct: 2,
                topic: "Algebra"
            },
            {
                question: "Which expression is equivalent to 4(x + 3)?",
                options: ["4x + 3", "4x + 12", "x + 12", "4x + 7"],
                correct: 1,
                topic: "Algebra"
            },
            {
                question: "If 2n + 3 = 15, what is the value of n?",
                options: ["4", "6", "8", "9"],
                correct: 1,
                topic: "Algebra"
            },
            {
                question: "What is the value of 3x¬≤ when x = 4?",
                options: ["24", "36", "48", "64"],
                correct: 2,
                topic: "Algebra"
            },
            {
                question: "Which equation represents 'twice a number decreased by 5 is 13'?",
                options: ["2x - 5 = 13", "2x + 5 = 13", "x/2 - 5 = 13", "x/2 + 5 = 13"],
                correct: 0,
                topic: "Algebra"
            },
            {
                question: "What is the solution to 5y - 8 = 2y + 10?",
                options: ["y = 2", "y = 4", "y = 6", "y = 8"],
                correct: 2,
                topic: "Algebra"
            },
            {
                question: "If a = 3 and b = 5, what is the value of 2a¬≤ - b?",
                options: ["7", "13", "17", "23"],
                correct: 1,
                topic: "Algebra"
            },
            {
                question: "Which is the correct factorization of x¬≤ + 5x + 6?",
                options: ["(x+2)(x+3)", "(x+1)(x+6)", "(x+2)(x+4)", "(x+3)(x+3)"],
                correct: 0,
                topic: "Algebra"
            },
            {
                question: "What is the slope of the line y = 2x + 3?",
                options: ["2", "3", "5", "x"],
                correct: 0,
                topic: "Algebra"
            },
            {
                question: "If 3(x - 4) = 15, what is the value of x?",
                options: ["5", "7", "9", "11"],
                correct: 2,
                topic: "Algebra"
            },
            {
                question: "What is the y-intercept of the line y = 4x - 7?",
                options: ["4", "-7", "7", "-4"],
                correct: 1,
                topic: "Algebra"
            },
            {
                question: "Which expression is equivalent to 5a √ó 3a?",
                options: ["15a", "15a¬≤", "8a¬≤", "8a"],
                correct: 1,
                topic: "Algebra"
            }
        ];

        // Polygon puzzle types
        const puzzleTypes = [
            {
                id: 1,
                name: "Circle",
                title: "Circle Puzzle",
                pieces: [
                    { id: 0, name: "Center", emoji: "‚ö´", color: "bg-red-400" },
                    { id: 1, name: "Radius", emoji: "üìè", color: "bg-blue-400" },
                    { id: 2, name: "Diameter", emoji: "üìê", color: "bg-green-400" },
                    { id: 3, name: "Circumference", emoji: "‚≠ï", color: "bg-yellow-400" },
                    { id: 4, name: "Arc", emoji: "‚óú", color: "bg-purple-400" },
                    { id: 5, name: "Chord", emoji: "‚îÅ", color: "bg-pink-400" },
                    { id: 6, name: "Sector", emoji: "‚óû", color: "bg-indigo-400" },
                    { id: 7, name: "Segment", emoji: "‚óù", color: "bg-teal-400" },
                    { id: 8, name: "Tangent", emoji: "‚ûñ", color: "bg-orange-400" }
                ]
            },
            {
                id: 2,
                name: "Square",
                title: "Square Puzzle",
                pieces: [
                    { id: 0, name: "Side", emoji: "üìè", color: "bg-red-400" },
                    { id: 1, name: "Vertex", emoji: "üî∫", color: "bg-blue-400" },
                    { id: 2, name: "Diagonal", emoji: "‚ûó", color: "bg-green-400" },
                    { id: 3, name: "Angle", emoji: "üìê", color: "bg-yellow-400" },
                    { id: 4, name: "Area", emoji: "üü¶", color: "bg-purple-400" },
                    { id: 5, name: "Perimeter", emoji: "üî≤", color: "bg-pink-400" },
                    { id: 6, name: "Center", emoji: "‚ö´", color: "bg-indigo-400" },
                    { id: 7, name: "Symmetry", emoji: "‚Üî", color: "bg-teal-400" },
                    { id: 8, name: "Right Angle", emoji: "üî∫", color: "bg-orange-400" }
                ]
            },
            {
                id: 3,
                name: "Triangle",
                title: "Triangle Puzzle",
                pieces: [
                    { id: 0, name: "Base", emoji: "üìè", color: "bg-red-400" },
                    { id: 1, name: "Height", emoji: "üìê", color: "bg-blue-400" },
                    { id: 2, name: "Hypotenuse", emoji: "‚ûó", color: "bg-green-400" },
                    { id: 3, name: "Vertex", emoji: "üî∫", color: "bg-yellow-400" },
                    { id: 4, name: "Angle", emoji: "üìê", color: "bg-purple-400" },
                    { id: 5, name: "Area", emoji: "üü¶", color: "bg-pink-400" },
                    { id: 6, name: "Perimeter", emoji: "üî∫", color: "bg-indigo-400" },
                    { id: 7, name: "Median", emoji: "‚ûñ", color: "bg-teal-400" },
                    { id: 8, name: "Right Angle", emoji: "üî∫", color: "bg-orange-400" }
                ]
            },
            {
                id: 4,
                name: "Hexagon",
                title: "Hexagon Puzzle",
                pieces: [
                    { id: 0, name: "Side", emoji: "üìè", color: "bg-red-400" },
                    { id: 1, name: "Vertex", emoji: "üî∫", color: "bg-blue-400" },
                    { id: 2, name: "Diagonal", emoji: "‚ûó", color: "bg-green-400" },
                    { id: 3, name: "Angle", emoji: "üìê", color: "bg-yellow-400" },
                    { id: 4, name: "Area", emoji: "üü¶", color: "bg-purple-400" },
                    { id: 5, name: "Perimeter", emoji: "üî≤", color: "bg-pink-400" },
                    { id: 6, name: "Center", emoji: "‚ö´", color: "bg-indigo-400" },
                    { id: 7, name: "Symmetry", emoji: "‚Üî", color: "bg-teal-400" },
                    { id: 8, name: "Apothem", emoji: "üìè", color: "bg-orange-400" }
                ]
            },
            {
                id: 5,
                name: "Pentagon",
                title: "Pentagon Puzzle",
                pieces: [
                    { id: 0, name: "Side", emoji: "üìè", color: "bg-red-400" },
                    { id: 1, name: "Vertex", emoji: "üî∫", color: "bg-blue-400" },
                    { id: 2, name: "Diagonal", emoji: "‚ûó", color: "bg-green-400" },
                    { id: 3, name: "Angle", emoji: "üìê", color: "bg-yellow-400" },
                    { id: 4, name: "Area", emoji: "üü¶", color: "bg-purple-400" },
                    { id: 5, name: "Perimeter", emoji: "üî≤", color: "bg-pink-400" },
                    { id: 6, name: "Center", emoji: "‚ö´", color: "bg-indigo-400" },
                    { id: 7, name: "Symmetry", emoji: "‚Üî", color: "bg-teal-400" },
                    { id: 8, name: "Apothem", emoji: "üìè", color: "bg-orange-400" }
                ]
            }
        ];

        let currentQuestions = [];
        let currentPuzzle = null;
        let currentPieceId = null;
        let score = 0;
        let unlockedCount = 0;

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame() {
            // Reset game state
            currentQuestions = shuffleArray(mathQuestions);
            currentPuzzle = shuffleArray(puzzleTypes)[0];
            
            // Initialize puzzle pieces
            currentPuzzle.pieces.forEach(piece => piece.unlocked = false);
            score = 0;
            unlockedCount = 0;
            
            // Show game screen
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('victoryScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            // Set puzzle title
            document.getElementById('puzzleTitle').textContent = currentPuzzle.title;
            
            // Generate puzzle grid
            generatePuzzleGrid();
            updateScore();
        }

        function generatePuzzleGrid() {
            const grid = document.getElementById('puzzleGrid');
            grid.innerHTML = '';
            
            currentPuzzle.pieces.forEach(piece => {
                const pieceElement = document.createElement('div');
                pieceElement.className = `puzzle-piece ${piece.color} rounded-lg p-6 text-center cursor-pointer border-2 border-gray-300 ${piece.unlocked ? 'unlocked' : 'locked'}`;
                pieceElement.onclick = () => selectPiece(piece.id);
                
                pieceElement.innerHTML = `
                    <div class="text-4xl mb-2">${piece.unlocked ? piece.emoji : 'üîí'}</div>
                    <div class="font-semibold text-white text-sm">${piece.unlocked ? piece.name : '???'}</div>
                `;
                
                grid.appendChild(pieceElement);
            });
        }

        function selectPiece(pieceId) {
            const piece = currentPuzzle.pieces[pieceId];
            if (piece.unlocked) return;
            
            currentPieceId = pieceId;
            
            // Highlight current piece
            document.querySelectorAll('.puzzle-piece').forEach((el, index) => {
                el.classList.remove('current');
                if (index === pieceId) {
                    el.classList.add('current');
                }
            });
            
            // Show question
            showQuestion();
        }

        function showQuestion() {
            // Get a random question from the current pool
            const question = currentQuestions[Math.floor(Math.random() * currentQuestions.length)];
            
            document.getElementById('question').textContent = question.question;
            
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn w-full bg-white hover:bg-purple-50 border-2 border-purple-200 text-gray-800 font-semibold py-3 px-4 rounded-lg text-left';
                button.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                button.onclick = () => selectAnswer(index, question.correct);
                optionsContainer.appendChild(button);
            });
            
            document.getElementById('questionPanel').classList.remove('hidden');
        }

        function selectAnswer(selectedIndex, correctIndex) {
            const options = document.querySelectorAll('.option-btn');
            
            // Disable all buttons
            options.forEach(btn => btn.disabled = true);
            
            if (selectedIndex === correctIndex) {
                // Correct answer
                options[selectedIndex].classList.add('correct');
                score += 5;
                
                setTimeout(() => {
                    unlockPiece(currentPieceId);
                    closeQuestion();
                }, 1500);
            } else {
                // Wrong answer
                options[selectedIndex].classList.add('wrong');
                options[correctIndex].classList.add('correct');
                
                setTimeout(() => {
                    closeQuestion();
                }, 2000);
            }
        }

        function unlockPiece(pieceId) {
            currentPuzzle.pieces[pieceId].unlocked = true;
            unlockedCount++;
            
            updateScore();
            generatePuzzleGrid();
            
            // Check if puzzle is complete
            if (unlockedCount === currentPuzzle.pieces.length) {
                setTimeout(() => {
                    showVictory();
                }, 1000);
            }
        }

        function closeQuestion() {
            document.getElementById('questionPanel').classList.add('hidden');
            document.querySelectorAll('.puzzle-piece').forEach(el => {
                el.classList.remove('current');
            });
            currentPieceId = null;
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('unlockedCount').textContent = unlockedCount;
        }

        function showVictory() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('victoryScreen').classList.remove('hidden');
            document.getElementById('finalScore').textContent = score;
        }

        function goToMainMenu() {
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('victoryScreen').classList.add('hidden');
            document.getElementById('questionPanel').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
        }
    </script>
</body>
</html>